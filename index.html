<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>QRã‚³ãƒ¼ãƒ‰èª­ã¿å–ã‚Šï¼ˆã‚¹ã‚¯ã‚·ãƒ§è²¼ä»˜ã‘å¯¾å¿œãƒ»ZXing/JSQRä½µç”¨ï¼‰</title>
<style>
  body{font-family:Segoe UI, sans-serif; padding:20px; background:#f5f5f5;}
  h1{font-size:1.8rem; margin-bottom:15px; text-align:center;}
  .card{background:white; padding:25px; border-radius:16px; box-shadow:0 4px 12px rgba(0,0,0,0.08); max-width:750px; margin:0 auto 20px auto;}
  button{padding:10px 20px; border:none; border-radius:10px; cursor:pointer; font-size:1rem; margin-right:10px; margin-top:5px;}
  #pasteBtn{background:#0078ff; color:white;}
  #pasteBtn.flash{animation:flash 0.6s ease-in-out infinite alternate;}
  #clipBtn{background:#28a745; color:white;}
  #resetBtn{background:#dc3545; color:white;}
  .droparea{border:2px dashed #bbb; padding:40px; text-align:center; border-radius:12px; background:white; margin-bottom:20px; font-size:1rem;}
  .droparea.highlight{border-color:#0078ff; background:#eef6ff;}
  img{max-width:100%; margin-top:15px; border-radius:12px;}
  .desc{font-size:1rem; color:#333; line-height:1.7; margin-bottom:10px;}
  .highlight-text{font-weight:bold; font-size:1.2rem; color:#d63384; margin-bottom:15px;}
</style>
<script src="https://unpkg.com/@zxing/library@latest"></script>
</head>
<body>
<div class="card">
  <h1>QRã‚³ãƒ¼ãƒ‰èª­ã¿å–ã‚Šï¼ˆã‚¹ã‚¯ã‚·ãƒ§è²¼ä»˜ã‘å¯¾å¿œï¼‰</h1>

  <p class="highlight-text">ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆå¾Œã€ã“ã®ãƒšãƒ¼ã‚¸ã§ <strong>Ctrl + V</strong> ã‚’æŠ¼ã—ã¦ãã ã•ã„ï¼</p>

    <div class="droparea" id="dropArea">
    Ctrl + V ã§è²¼ã‚Šä»˜ã‘<br>ã¾ãŸã¯<br>QRã‚³ãƒ¼ãƒ‰ç”»åƒã‚’ã“ã“ã«ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—
  </div>

  <img id="preview" style="display:none;" />
  <p id="result" class="desc"></p>

  <p class="desc">ã†ã¾ãè²¼ã‚Šä»˜ã‹ãªã„å ´åˆã¯ã€Œè²¼ä»˜ã‘ã‚’å¾…æ©Ÿã—ã¦é–‹å§‹ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã‹ã€ä¸‹ã®ã€Œã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã‹ã‚‰èª­ã¿å–ã‚‹ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚</p>

  <button id="clipBtn">ğŸ“‹ ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã‹ã‚‰èª­ã¿å–ã‚‹</button>
  <button id="pasteBtn">ğŸ“Œ è²¼ä»˜ã‘ã‚’å¾…æ©Ÿã—ã¦é–‹å§‹</button>
  <button id="resetBtn">ğŸ”„ ãƒªã‚»ãƒƒãƒˆ</button>
</div>

<!-- â–¼â–¼â–¼ ã“ã“ã‹ã‚‰ä¸‹ã«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆèª¬æ˜ï¼ˆæœ€ä¸‹æ®µï¼‰ â–¼â–¼â–¼ -->
<div class="card" style="margin-top:30px;">
  <h2 style="text-align:center;">ğŸ“¸ ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã®å–å¾—æ–¹æ³•</h2>
<div style="display: flex; align-items: center;">
  <p class="highlight-text" style="margin: 0; max-width: 300px; word-break: break-word;">
    <strong>Windowsã‚­ãƒ¼ + Shift + S</strong> <br>
    ä¸Šè¨˜ã‚’åŒæ™‚æŠ¼ã—ã—ã¾ã™ã€‚
  </p>
  <img src="shortcut.png" alt="Windows + Shift + S ã®èª¬æ˜" style="margin-left: 10px; max-width: 180px; border:1px solid #ccc;">
</div>


  <p class="desc">
    ã“ã®ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã‚’æŠ¼ã™ã¨ç”»é¢ãŒå°‘ã—æš—ããªã‚Šã€åˆ‡ã‚Šå–ã‚Šãƒ„ãƒ¼ãƒ«ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚<br>
    åˆ‡ã‚ŠãŸã„ç¯„å›²ã‚’ãƒ‰ãƒ©ãƒƒã‚°ã™ã‚‹ã¨ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ä¿å­˜ã•ã‚Œã€<br>
    ãã®å¾Œã“ã®ãƒšãƒ¼ã‚¸ã§ <strong>Ctrl + V</strong> ã‚’æŠ¼ã›ã°è‡ªå‹•ã§è²¼ã‚Šä»˜ã‘ã‚‰ã‚Œã¾ã™ã€‚
  </p>
</div>
<!-- â–²â–²â–² ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆèª¬æ˜ã“ã“ã¾ã§ â–²â–²â–² -->


<script>
let pasteMode = false;
const pasteBtn = document.getElementById('pasteBtn');
const clipBtn = document.getElementById('clipBtn');
const resetBtn = document.getElementById('resetBtn');
const preview = document.getElementById('preview');

pasteBtn.addEventListener('click', () => {
  pasteMode = true;
  pasteBtn.classList.add('flash');
  pasteBtn.textContent = "ğŸ“¥ Ctrl + V ã‚’å¾…æ©Ÿä¸­â€¦";
});

clipBtn.addEventListener('click', async () => {
  try {
    const items = await navigator.clipboard.read();
    for (const item of items) {
      if (item.types.includes('image/png') || item.types.includes('image/jpeg')) {
        const type = item.types.includes('image/png') ? 'image/png' : 'image/jpeg';
        const blob = await item.getType(type);
        displayImage(blob);
        return;
      }
    }
    alert('ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ç”»åƒãŒã‚ã‚Šã¾ã›ã‚“ã€‚');
  } catch (e) {
    alert('ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã®èª­ã¿å–ã‚ŠãŒè¨±å¯ã•ã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚HTTPSã§ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ãã ã•ã„ã€‚');
  }
});

resetBtn.addEventListener('click', () => {
  preview.src = '';
  preview.style.display = 'none';
  document.getElementById('result').textContent = '';
  pasteMode = false;
  pasteBtn.classList.remove('flash');
  pasteBtn.textContent = "ğŸ“Œ è²¼ä»˜ã‘ã‚’å¾…æ©Ÿã—ã¦é–‹å§‹";
});

window.addEventListener('paste', e => {
  if (!pasteMode) return;
  handlePaste(e);
});
window.addEventListener('paste', handlePaste);

function handlePaste(e){
  const items = e.clipboardData.items;
  for (let i of items){
    if (i.type.indexOf("image") === 0){
      const blob = i.getAsFile();
      displayImage(blob);
      pasteMode = false;
      pasteBtn.classList.remove('flash');
      pasteBtn.textContent = "ğŸ“Œ è²¼ä»˜ã‘ã‚’å¾…æ©Ÿã—ã¦é–‹å§‹";
      break;
    }
  }
}

const dropArea = document.getElementById('dropArea');
dropArea.addEventListener('dragover', e => { e.preventDefault(); dropArea.classList.add('highlight'); });
dropArea.addEventListener('dragleave', () => dropArea.classList.remove('highlight'));
dropArea.addEventListener('drop', e => {
  e.preventDefault(); dropArea.classList.remove('highlight');
  const file = e.dataTransfer.files[0];
  if (file) displayImage(file);
});

function displayImage(file){
  const reader = new FileReader();
  reader.onload = function(){
    preview.src = reader.result;
    preview.style.display = "block";
    decodeQR(reader.result);
  };
  reader.readAsDataURL(file);
}

async function decodeQR(dataURL){
  const result = document.getElementById('result');
  result.textContent = "QRã‚³ãƒ¼ãƒ‰ã‚’è§£æä¸­â€¦";
  let success = false;

  try {
    if (!window.jsQR){
      await import('https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.js');
    }

    await new Promise(resolve => {
      if (preview.complete) resolve();
      else preview.onload = resolve;
    });

    const maxSize = 800;
    const scale = Math.min(maxSize / preview.naturalWidth, maxSize / preview.naturalHeight, 1);
    const w = Math.floor(preview.naturalWidth * scale);
    const h = Math.floor(preview.naturalHeight * scale);

    const canvas = document.createElement('canvas');
    const ctx = canvas.getContext('2d');
    canvas.width = w;
    canvas.height = h;
    ctx.drawImage(preview, 0, 0, w, h);

    const imageData = ctx.getImageData(0, 0, w, h);
    const qr = jsQR(imageData.data, w, h);

    if (qr && qr.data){
      result.innerHTML = `<strong>èª­ã¿å–ã‚Šçµæœï¼ˆjsQRï¼‰:</strong><br><a href="${qr.data}" target="_blank">${qr.data}</a>`;
      success = true;
    }
  } catch (e){
  }

  if (!success){
    try {
      const codeReader = new ZXing.BrowserQRCodeReader();
      await codeReader.decodeFromImageElement(preview)
        .then(decoded => {
          result.innerHTML = `<strong>èª­ã¿å–ã‚Šçµæœï¼ˆZXingï¼‰:</strong><br>${decoded.text}`;
          success = true;
        });
    } catch (e){
      result.textContent = "QRã‚³ãƒ¼ãƒ‰ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚";
    }
  }
}
</script>

</body>
</html>
